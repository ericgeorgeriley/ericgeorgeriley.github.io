<!DOCTYPE html>
<html lang="en">
<head>
  <title>once.ly | protect your privacy with one-time-use
    shortened URLs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico" />

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

  <script>
    $(document).ready(function () {
      $('#oform').submit(function (event) {
        event.preventDefault();

        var $oform = $(this),
          url = $oform.find('input[name=url]').val(),
          tries = $oform.find('input[name=tries]').val(),
          expires = $oform.find('select[name=expires]').val(),
          fallback_url = $oform.find('input[name=fallback_url]').val(),
          fallback_expires = $oform.find('select[name=fallback_expires]').val(),
		  action="http://once.ly/"
          //action = $oform.attr('action');

        var payload = {
          url: url,
          tries: tries,
          expires: expires
        };

        if (fallback_url.length > 0) {
          payload['fallback_url'] = fallback_url;
          payload['fallback_expires'] = fallback_expires;
        }

		console.log(action);
        var response = $.ajax({
          url: action,
          type: 'POST',
          contentType : 'application/json',
          data: JSON.stringify(payload),
          success: function (data) {
            $('#ourl').val('http://once.ly/' + data.id);

            $('#oresults').show('slow');
          },
          error: function (jqXHR) {
            window.alert(jqXHR.responseText);
          }
        });

        return true;
      });
    });
  </script>
</head>

<body>

<div class="container">
  <h2>once.ly</h2>

  <h3>protect your privacy with one-time-use shortened URLs</h3>

  <p>once.ly version 0.00000manyzeroesbeta1 - use at your own risk!</p>

  <form id="oform" class="form-horizontal" action="/">
    <div class="form-group">
      <label class="control-label col-sm-2" for="url">URL to shorten</label>
      <div class="col-sm-4">
        <input id="url" name="url" type="text" placeholder="http://" class="form-control" />
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="tries">Resolve</label>
      <div class="col-sm-2">
        <div class="input-group">
          <input name="tries" type="text" class="form-control" value="1" />
          <div class="input-group-addon">time(s)</div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="expires">Good for</label>
      <div class="col-sm-3">
        <select name="expires" class="form-control">
          <option value="60">one minute</option>
          <option value="300">five minutes</option>
          <option value="600">ten minutes</option>
          <option value="1800">thirty minutes</option>
          <option value="3600" selected="true">one hour</option>
          <option value="7200">two hours</option>
          <option value="10800">three hours</option>
          <option value="86400">one day</option>
          <option value="172800">two days</option>
          <option value="259200">three days</option>
          <option value="604800">one week</option>
          <option value="2592000">thirty days</option>
          <option value="7889400">three months</option>
          <option value="15778800">six months</option>
          <option value="31557600">one year</option>
        </select>
      </div>
    </div>
    <hr class="featurette-divider">
    <div class="row">
      <h5 class="col-md-6 text-uppercase text-info">Optional</h5>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="fallback_url">Fallback URL</label>
      <div class="col-sm-4">
        <input id="fallback_url" name="fallback_url" type="text" placeholder="http://" class="form-control" />
        <span lass="help-block">Optionally redirect the user to this URL when the shortened link is expired.</span>
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2" for="fallback_expires">Fall back for</label>
      <div class="col-sm-3">
        <select name="fallback_expires" class="form-control">
          <option value="0" selected="true">-- choose one --</option>
          <option value="60">one minute</option>
          <option value="300">five minutes</option>
          <option value="600">ten minutes</option>
          <option value="1800">thirty minutes</option>
          <option value="3600">one hour</option>
          <option value="7200">two hours</option>
          <option value="10800">three hours</option>
          <option value="86400">one day</option>
          <option value="172800">two days</option>
          <option value="259200">three days</option>
          <option value="604800">one week</option>
          <option value="2592000">thirty days</option>
          <option value="7889400">three months</option>
          <option value="15778800">six months</option>
          <option value="31557600">one year</option>
        </select>
      </div>
    </div>
    <hr class="featurette-divider">
    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-4">
        <button type="submit" class="btn btn-default">Shorten!</button>
      </div>
    </div>
    <div class="form-group" id="oresults" style="display: none">
      <label class="control-label col-sm-2" for="ourl">Your shortened URL is</label>
      <div class="col-sm-4">
        <input id="ourl" type="text" class="form-control" readonly=true onclick="this.select()" />
      </div>
    </div>
  </form>

</div>

</body>
</html>
